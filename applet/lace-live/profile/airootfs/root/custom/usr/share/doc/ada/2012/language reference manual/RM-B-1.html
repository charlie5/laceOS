<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Interfacing Aspects</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-B.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-B-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>B.1 Interfacing Aspects</H1>
<div class="paranum"><a name="p0.1">0.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;An <I>interfacing</I> aspect is a representation 
aspect that is one of the aspects Import, Export, Link_Name, External_Name, 
or Convention.<A NAME="I7382"></A><A NAME="I7383"></A></div>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Normal"><A NAME="I7384"></A><A NAME="I7385"></A>Specifying 
the Import aspect  to have the value True is used to import an entity 
defined in a foreign language into an Ada program, thus allowing a foreign-language 
subprogram to be called from Ada, or a foreign-language variable to be 
accessed from Ada. In contrast, <A NAME="I7386"></A><A NAME="I7387"></A>specifying 
the Export aspect to have the value True is used to export an Ada entity 
to a foreign language, thus allowing an Ada subprogram to be called from 
a foreign language, or an Ada object to be accessed from a foreign language. 
The Import and Export aspects are intended primarily for objects and 
subprograms, although implementations are allowed to support other entities. 
The Link_Name and External_Name aspects are used to specify the link 
name and external name, respectively, to be used to identify imported 
or exported entities in the external environment.<A NAME="I7388"></A><A NAME="I7389"></A><A NAME="I7390"></A><A NAME="I7391"></A> 
<A NAME="I7392"></A><A NAME="I7393"></A><A NAME="I7394"></A><A NAME="I7395"></A><A NAME="I7396"></A></div>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="Normal">The Convention aspect<A NAME="I7397"></A><A NAME="I7398"></A> 
is used to indicate that an Ada entity should use the conventions of 
another language. It is intended primarily for types and &ldquo;callback&rdquo; 
subprograms. For example, &ldquo;<B>with</B> Convention =&gt; Fortran&rdquo; 
on the declaration of an array type Matrix implies that Matrix should 
be represented according to the conventions of the supported Fortran 
implementation, namely column-major order.</div>
<div class="paranum"><a name="p3">3</a></div>
<div class="Normal">A <SPAN Class="swiss"><A HREF="RM-2-8.html#S0019">pragma</A></SPAN> 
Linker_Options is used to specify the system linker parameters needed 
when a given compilation unit is included in a partition.</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">The form of a <SPAN Class="swiss"><A HREF="RM-2-8.html#S0019">pragma</A></SPAN> 
Linker_Options is as follows:&nbsp;</div>
<div class="Indented1"><SPAN STYLE="font-size: 80%"><I>Paragraphs 5 through 
7 were moved to <A HREF="RM-J.html">Annex J</A>, &ldquo;<A HREF="RM-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Indented1">&nbsp;&nbsp;<B>pragma</B> <A NAME="I7399"></A><A NAME="I7400"></A>Linker_Options(<I>string_</I><A NAME="I7401"></A><SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN>);</div>
<div class="paranum"><a name="p9">9</a></div>
<div class="Indented1">A <SPAN Class="swiss"><A HREF="RM-2-8.html#S0019">pragma</A></SPAN> 
Linker_Options is allowed only at the place of a <SPAN Class="swiss"><A HREF="RM-3-11.html#S0087">declarative_item</A></SPAN>.</div>
<div class="paranum"><a name="p9.1">9.1/3</a></div>
<div class="Indented1"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p9.2">9.2/3</a></div>
<div class="Normal">&nbsp;&nbsp;The Import and Export aspects are of type Boolean.</div>
<div class="paranum"><a name="p10">10/3</a></div>
<div class="Normal">&nbsp;The Link_Name and External_Name aspects are of type 
String.&nbsp;</div>
<div class="paranum"><a name="p10.1">10.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;<A NAME="I7402"></A>The expected type for the 
<I>string_</I><A NAME="I7403"></A><SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN> 
in pragma Linker_Options is String.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Normal">&nbsp;<A NAME="I7404"></A>The aspect Convention shall 
be specified by a <I>convention_</I><SPAN Class="swiss"><A HREF="RM-2-3.html#S0002">identifier</A></SPAN> 
which shall be the name of a <I>convention</I>. The convention names 
are implementation defined, except for certain language-defined ones, 
such as Ada and Intrinsic, as explained in <A HREF="RM-6-3-1.html">6.3.1</A>, 
&ldquo;<A HREF="RM-6-3-1.html">Conformance Rules</A>&rdquo;. Additional 
convention names generally represent the calling conventions of foreign 
languages, language implementations, or specific run-time models. <A NAME="I7405"></A>The 
convention of a callable entity is its <I>calling convention</I>.&nbsp;</div>
<div class="paranum"><a name="p12">12</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><A NAME="I7406"></A>If 
<I>L</I> is a <I>convention_</I><SPAN Class="swiss"><A HREF="RM-2-3.html#S0002">identifier</A></SPAN> 
for a language, then a type T is said to be <I>compatible with convention 
L</I>, (alternatively, is said to be an <I>L-compatible type</I>) if 
any of the following conditions are met:&nbsp;</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Bulleted">T is declared in a language interface package corresponding 
to <I>L</I> and is defined to be <I>L</I>-compatible (see <A HREF="RM-B-3.html">B.3</A>, 
<A HREF="RM-B-3-1.html">B.3.1</A>, <A HREF="RM-B-3-2.html">B.3.2</A>, 
<A HREF="RM-B-4.html">B.4</A>, <A HREF="RM-B-5.html">B.5</A>),</div>
<div class="paranum"><a name="p14">14/3</a></div>
<div class="Bulleted" style="margin-bottom: 0.3em"><A NAME="I7407"></A>Convention 
<I>L</I> has been specified for T, and T is <I>eligible for convention 
L</I>; that is:&nbsp;</div>
<div class="paranum"><a name="p14.1">14.1/4</a></div>
<div class="Indented2NestedBulleted">T is an enumeration type such that 
all internal codes (whether assigned by default or explicitly) are within 
an implementation-defined range that includes at least the range of values 
0 .. 2**15&ndash;1;</div>
<div class="paranum"><a name="p15">15</a></div>
<div class="Indented2NestedBulleted">T is an array type with either an 
unconstrained or statically-constrained first subtype, and its component 
type is <I>L</I>-compatible,</div>
<div class="paranum"><a name="p16">16</a></div>
<div class="Indented2NestedBulleted">T is a record type that has no discriminants 
and that only has components with statically-constrained subtypes, and 
each component type is <I>L</I>-compatible,</div>
<div class="paranum"><a name="p17">17/3</a></div>
<div class="Indented2NestedBulleted">T is an access-to-object type, its 
designated type is <I>L</I>-compatible, and its designated subtype is 
not an unconstrained array subtype,</div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Indented2NestedBulleted">T is an access-to-subprogram type, 
and its designated profile's parameter and result types are all <I>L</I>-compatible. 
</div>
<div class="paranum"><a name="p19">19</a></div>
<div class="Bulleted">T is derived from an <I>L</I>-compatible type,</div>
<div class="paranum"><a name="p20">20</a></div>
<div class="Bulleted">The implementation permits T as an <I>L</I>-compatible 
type.</div>
<div class="paranum"><a name="p21">21/3</a></div>
<div class="Normal">&nbsp;If the Convention aspect is specified for a type, 
then the type shall either be compatible with or eligible for the specified 
convention.&nbsp;</div>
<div class="paranum"><a name="p22">22/3</a></div>
<div class="Normal">&nbsp;<A NAME="I7408"></A>Notwithstanding any rule to 
the contrary, a declaration with a True Import aspect shall not have 
a completion.&nbsp;</div>
<div class="paranum"><a name="p23">23/3</a></div>
<div class="Normal">&nbsp;<A NAME="I7409"></A> <A NAME="I7410"></A>An entity 
with a True Import aspect (or Export aspect) is said to be <I>imported</I> 
(respectively, <I>exported</I>). An entity shall not be both imported 
and exported.</div>
<div class="paranum"><a name="p24">24</a></div>
<div class="Normal">The declaration of an imported object shall not include 
an explicit initialization expression. Default initializations are not 
performed.&nbsp;</div>
<div class="paranum"><a name="p25">25/3</a></div>
<div class="Normal">&nbsp;The type of an imported or exported object shall 
be compatible with the specified Convention aspect, if any.&nbsp;</div>
<div class="paranum"><a name="p26">26/3</a></div>
<div class="Normal">&nbsp;For an imported or exported subprogram, the result 
and parameter types shall each be compatible with the specified Convention 
aspect, if any.</div>
<div class="paranum"><a name="p27">27/3</a></div>
<div class="Normal">&nbsp;The <SPAN Class="swiss"><A HREF="RM-13-1-1.html#S0309">aspect_definition</A></SPAN> 
(if any) used to directly specify an Import, Export, External_Name, or 
Link_Name aspect shall be a static expression. The <I>string_</I><SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN> 
of a <SPAN Class="swiss"><A HREF="RM-2-8.html#S0019">pragma</A></SPAN> 
Linker_Options shall be static. An External_Name or Link_Name aspect 
shall be specified only for an entity that is either imported or exported.</div>

<H4 Class="centered">Static Semantics</H4>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 28 and 
29 were deleted.</I></SPAN>&nbsp;</div>
<div class="paranum"><a name="p30">30/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;The Convention aspect 
represents the calling convention or representation convention of the 
entity. For an access-to-subprogram type, it represents the calling convention 
of designated subprograms. In addition:&nbsp;</div>
<div class="paranum"><a name="p31">31/3</a></div>
<div class="Bulleted">A True Import aspect indicates that the entity 
is defined externally (that is, outside the Ada program). This aspect 
is never inherited; if not directly specified, the Import aspect is False.</div>
<div class="paranum"><a name="p32">32/3</a></div>
<div class="Bulleted">A True Export aspect indicates that the entity 
is used externally. This aspect is never inherited; if not directly specified, 
the Export aspect is False.</div>
<div class="paranum"><a name="p33">33/3</a></div>
<div class="Bulleted">For an entity with a True Import or Export aspect, 
an external name, link name, or both may also be specified.&nbsp;</div>
<div class="paranum"><a name="p34">34</a></div>
<div class="Normal"><A NAME="I7411"></A>An <I>external name</I> is a 
string value for the name used by a foreign language program either for 
an entity that an Ada program imports, or for referring to an entity 
that an Ada program exports.</div>
<div class="paranum"><a name="p35">35</a></div>
<div class="Normal"><A NAME="I7412"></A>A <I>link name</I> is a string 
value for the name of an exported or imported entity, based on the conventions 
of the foreign language's compiler in interfacing with the system's linker 
tool.</div>
<div class="paranum"><a name="p36">36</a></div>
<div class="Normal">The meaning of link names is implementation defined. 
If neither a link name nor the Address attribute of an imported or exported 
entity is specified, then a link name is chosen in an implementation-defined 
manner, based on the external name if one is specified.&nbsp;</div>
<div class="paranum"><a name="p37">37</a></div>
<div class="Normal">Pragma Linker_Options has the effect of passing its 
string argument as a parameter to the system linker (if one exists), 
if the immediately enclosing compilation unit is included in the partition 
being linked. The interpretation of the string argument, and the way 
in which the string arguments from multiple Linker_Options pragmas are 
combined, is implementation defined.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p38">38/3</a></div>
<div class="Normal">&nbsp;<A NAME="I7413"></A><A NAME="I7414"></A>Notwithstanding 
what this International Standard says elsewhere, the elaboration of a 
declaration with a True Import aspect does not create the entity. Such 
an elaboration has no other effect than to allow the defining name to 
denote the external entity.&nbsp;</div>

<H4 Class="centered">Erroneous Execution</H4>
<div class="paranum"><a name="p38.1">38.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;<A NAME="I7415"></A>It is the programmer's responsibility 
to ensure that the use of interfacing aspects does not violate Ada semantics; 
otherwise, program execution is erroneous.&nbsp;</div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum"><a name="p39">39/3</a></div>
<div class="Normal">&nbsp;If an implementation supports Export for a given 
language, then it should also allow the main subprogram to be written 
in that language. It should support some mechanism for invoking the elaboration 
of the Ada library units included in the system, and for invoking the 
finalization of the environment task. On typical systems, the recommended 
mechanism is to provide two subprograms whose link names are &quot;adainit&quot; 
and &quot;adafinal&quot;. Adainit should contain the elaboration code 
for library units. Adafinal should contain the finalization code. These 
subprograms should have no effect the second and subsequent time they 
are called. <A NAME="I7416"></A><A NAME="I7417"></A><A NAME="I7418"></A><A NAME="I7419"></A></div>
<div class="paranum"><a name="p40">40/3</a></div>
<div class="Normal">&nbsp;Automatic elaboration of preelaborated packages 
should be provided when specifying the Export aspect as True is supported. 
</div>
<div class="paranum"><a name="p41">41/4</a></div>
<div class="Normal">&nbsp;For each supported convention <I>L</I> other than 
Intrinsic, an implementation should support specifying the Import and 
Export aspects for objects of <I>L</I>-compatible types and for subprograms, 
and the Convention aspect for <I>L</I>-eligible types and for subprograms, 
presuming the other language has corresponding features. Specifying the 
 Convention aspect need not be supported for scalar types, other than 
enumeration types whose internal codes fall within the range 0 .. 2**15&ndash;1. 
</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p42">42/3</a></div>
<div class="Notes">1&nbsp;&nbsp;Implementations may place restrictions 
on interfacing aspects; for example, requiring each exported entity to 
be declared at the library level.&nbsp;</div>
<div class="paranum"><a name="p43">43/3</a></div>
<div class="Notes">2&nbsp;&nbsp;The Convention aspect in combination 
with the Import aspect indicates the conventions for accessing external 
entities. It is possible that the actual entity is written in assembly 
language, but reflects the conventions of a particular language. For 
example, <TT><B>with</B> Convention =&gt; Ada</TT> can be used to interface 
to an assembly language routine that obeys the Ada compiler's calling 
conventions.</div>
<div class="paranum"><a name="p44">44/3</a></div>
<div class="Notes">3&nbsp;&nbsp;To obtain &ldquo;call-back&rdquo; to 
an Ada subprogram from a foreign language environment, the Convention 
aspect should be specified both for the access-to-subprogram type and 
the specific subprogram(s) to which 'Access is applied.</div>
<div class="Notes"><SPAN STYLE="font-size: 80%"><I>Paragraphs 45 and 
46 were deleted.</I></SPAN>&nbsp;</div>
<div class="paranum"><a name="p47">47</a></div>
<div class="Notes">4&nbsp;&nbsp;See also <A HREF="RM-13-8.html">13.8</A>, 
&ldquo;<A HREF="RM-13-8.html">Machine Code Insertions</A>&rdquo;.&nbsp;</div>
<div class="paranum"><a name="p48">48/3</a></div>
<div class="Notes">5&nbsp;&nbsp;If both External_Name and Link_Name are 
specified for a given entity, then the External_Name is ignored.</div>
<div class="paranum"><a name="p49">49/2</a></div>
<div class="Notes"><SPAN STYLE="font-size: 80%"><I>This paragraph was 
deleted.</I></SPAN></div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p50">50/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;<I>Example of interfacing 
aspects:</I>&nbsp;</div>
<div class="paranum"><a name="p51">51/3</a></div>
<div class="Examples"><B>package</B>&nbsp;Fortran_Library&nbsp;<B>is</B><BR>
&nbsp;&nbsp;<B>function</B>&nbsp;Sqrt&nbsp;(X&nbsp;:&nbsp;Float)&nbsp;<B>return</B>&nbsp;Float<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Import&nbsp;=&gt;&nbsp;True,&nbsp;Convention&nbsp;=&gt;&nbsp;Fortran;<BR>
&nbsp;&nbsp;<B>type</B>&nbsp;Matrix&nbsp;<B>is&nbsp;array</B>&nbsp;(Natural&nbsp;<B>range</B>&nbsp;&lt;&gt;,&nbsp;Natural&nbsp;<B>range</B>&nbsp;&lt;&gt;)&nbsp;<B>of</B>&nbsp;Float<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Convention&nbsp;=&gt;&nbsp;Fortran;<BR>
&nbsp;&nbsp;<B>function</B>&nbsp;Invert&nbsp;(M&nbsp;:&nbsp;Matrix)&nbsp;<B>return</B>&nbsp;Matrix<BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Import&nbsp;=&gt;&nbsp;True,&nbsp;Convention&nbsp;=&gt;&nbsp;Fortran;<BR>
<B>end</B>&nbsp;Fortran_Library;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-B.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-B-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
