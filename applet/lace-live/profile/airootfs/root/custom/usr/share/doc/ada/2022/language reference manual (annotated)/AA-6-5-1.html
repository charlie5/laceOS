<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Nonreturning Subprograms</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.8em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 202x Draft 33)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>6.5.1 <span class="insert5">Nonreturning Subprograms</span><span class="delete5">Pragma No_Return</span></H1>
<div class="paranum"><a name="p1">1/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00329.TXT">AI95-00329-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0418-1.TXT">AI12-0418-1</A></I>} 
Specifying aspect No_Return to have the value True indicates that a <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
cannot return normally[; it may<span class="insert5">, for example,</span> 
propagate an exception or loop forever].&nbsp;</div>
<div class="paranum"><a name="p1.a">1.a/5</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>Aspect No_Deposit<A NAME="I4372"></A> 
will have to wait for Ada <span class="insert5">2028</span><span class="delete5">&nbsp;2020</span>. 
:-)&nbsp;</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 2 and 
3 were moved to <A HREF="AA-J.html">Annex J</A>, &ldquo;<A HREF="AA-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p3.1">3.1/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
For a <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
or generic <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span>, 
the following language-defined representation aspect may be specified: 
</div>
<div class="paranum"><a name="p3.2">3.2/3</a></div>
<div class="WideHanging-Term">&nbsp;No_Return</div><div class="WideHanging-Body">
The type of aspect No_Return is Boolean. When aspect No_Return is True 
for an entity, the entity is said to be <I>nonreturning</I>.<A NAME="I4373"></A><A NAME="I4374"></A><A NAME="I4375"></A></div>
<div class="paranum"><a name="p3.3">3.3/5</a></div>
<div class="WideHanging-Body">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0423-1.TXT">AI12-0423-1</A></I>} 
If directly specified, the <SPAN Class="swiss"><A HREF="AA-13-1-1.html#S0348">aspect_definition</A></SPAN> 
shall be a static expression. <span class="insert5">When not directly 
specified, if the subprogram is a primitive subprogram inherited by a 
derived type, then the aspect is True if any corresponding subprogram 
of the parent or progenitor types is nonreturning. Otherwise</span><span class="delete5">&nbsp;[This 
aspect is never inherited;] if not directly specified</span>, the aspect 
is False.</div>
<div class="paranum"><a name="p3.a">3.a/5</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>No_Return: 
</B>A <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
will not return normally.</div>
<div class="paranum"><a name="p3.4">3.4/5</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
If a generic <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
is nonreturning, then so are its instances. If a <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
declared within a generic unit is nonreturning, then so are the corresponding 
copies of that <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
in instances.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00329.TXT">AI95-00329-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
Aspect No_Return shall not be specified for a null procedure nor an instance 
of a generic unit.</div>
<div class="paranum"><a name="p4.a">4.a/2</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>A null procedure cannot have 
the appropriate nonreturning semantics, as it does not raise an exception 
or loop forever.&nbsp;</div>
<div class="paranum"><a name="p4.b">4.b/5</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
The procedure can be abstract. If a nonreturning <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
is renamed (anywhere) calls through the new name still have the nonreturning 
semantics.&nbsp;</div>
<div class="paranum"><a name="p5">5/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00329.TXT">AI95-00329-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
A return statement shall not apply to a nonreturning procedure or generic 
procedure.</div>
<div class="paranum"><a name="p5.1">5.1/5</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
<span class="insert5">Any return statement that applies to a nonreturning 
function or generic function shall be a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0222">simple_return_statement</A></SPAN> 
with an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
that is a <SPAN Class="swiss"><A HREF="AA-11-3.html#S0309">raise_expression</A></SPAN>, 
a call on a nonreturning function, or a parenthesized <SPAN Class="swiss"><A HREF="AA-4-4.html#S0132">expression</A></SPAN> 
of one of these.</span></div>
<div class="paranum"><a name="p5.a">5.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Ramification:&nbsp;</B>We 
still require at least one return statement in a function; we just require 
that all such return statements don't actually return a value.</span> 
</div>
<div class="paranum"><a name="p6">6/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
A <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
shall be nonreturning if it overrides a dispatching nonreturning <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span>. 
<A NAME="I4376"></A>In addition to the places where Legality Rules normally 
apply (see <A HREF="AA-12-3.html">12.3</A>), this rule applies also in 
the private part of an instance of a generic unit.</div>
<div class="paranum"><a name="p6.a">6.a/5</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>This ensures that dispatching 
calls to nonreturning <span class="insert5">subprograms</span><span class="delete5">&nbsp;procedures</span> 
will, in fact, not return.&nbsp;</div>
<div class="paranum"><a name="p7">7/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
If a renaming-as-body completes a nonreturning <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
declaration, then the renamed <span class="insert5">subprogram</span><span class="delete5">&nbsp;procedure</span> 
shall be nonreturning.</div>
<div class="paranum"><a name="p7.a">7.a/2</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>This ensures that no extra code 
is needed to implement the renames (that is, no wrapper is needed) as 
the body has the same property.&nbsp;</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraph 8 was deleted.</I></SPAN> 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p9">9/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00329.TXT">AI95-00329-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
If the body of a nonreturning procedure completes normally, Program_Error 
is raised at the point of the call. <A NAME="I4377"></A></div>
<div class="paranum"><a name="p9.a">9.a/5</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
Note that there is no name for suppressing this check, since the check 
represents a bug, imposes no time overhead, and minimal space overhead 
(since it can usually be statically eliminated as dead code).<span class="insert5">&nbsp;We don't need a similar rule for nonreturning functions as this is standard 
semantics for all functions that normally complete without a transfer 
of control (such as a return statement).</span>&nbsp;</div>
<div class="paranum"><a name="p9.b">9.b/2</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>If a nonreturning 
procedure tries to return, we raise Program_Error. This is stated as 
happening at the call site, because we do not wish to allow the procedure 
to handle the exception (and then, perhaps, try to return again!). However, 
the expected run-time model is that the compiler will generate <B>raise</B> 
Program_Error at the end of the procedure body (but not handleable by 
the procedure itself), as opposed to doing it at the call site. (This 
is just like the typical run-time model for functions that fall off the 
end without returning a value). The reason is indirect calls: in P.<B>all</B>(...);, 
the compiler cannot know whether P designates a nonreturning procedure 
or a normal one. Putting the <B>raise</B> Program_Error in the procedure's 
generated code solves this problem neatly.</div>
<div class="paranum"><a name="p9.c">9.c/2</a></div>
<div class="Annotations">Similarly, if one passes a nonreturning procedure 
to a generic formal parameter, the compiler cannot know this at call 
sites (in shared code implementations); the raise-in-body solution deals 
with this neatly.&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p10">10/5</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0429-1.TXT">AI12-0429-1</A></I>} 
<span class="insert5"><I>Example of a specification of a No_Return aspect:</I></span> 
</div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00433.TXT">AI95-00433-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<B>procedure</B>&nbsp;Fail(Msg&nbsp;:&nbsp;String)&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;raises&nbsp;Fatal_Error&nbsp;exception</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;No_Return;<BR>
&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;Inform&nbsp;compiler&nbsp;and&nbsp;reader&nbsp;that&nbsp;procedure&nbsp;never&nbsp;returns&nbsp;normally</I></SPAN></div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p11.a">11.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00329.TXT">AI95-00329-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00414.TXT">AI95-00414-01</A></I>} 
<A NAME="I4378"></A><SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">Pragma</A></SPAN> 
No_Return is new.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p11.b">11.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I4379"></A>Aspect No_Return is new; <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
No_Return is now obsolescent.&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 2012</H4>
<div class="paranum"><a name="p11.c">11.c/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0423-1.TXT">AI12-0423-1</A></I>} 
<span class="insert4"><A NAME="I4380"></A><B>Correction:</B> Clarified 
that the nonreturning property is inherited by derivation. A literal 
implementation of the Ada 2012 would mean that no overriding would ever 
be rejected, as the inherited routine would never be nonreturning. Ada 
2022 requires overridings of dispatching nonreturning subprograms to 
be rejected. This is formally incompatible, but practically such overridings 
have been rejected in practice.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p11.d">11.d/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0269-1.TXT">AI12-0269-1</A></I>} 
<span class="insert5"><A NAME="I4381"></A>Aspect No_Return can now be 
applied to functions as well as procedures.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
