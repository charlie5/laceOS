<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Containers</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    SPAN.insert5 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete5 {text-decoration: line-through; color: rgb(0,102,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.SmallBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 9.3em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.SmallBulleted {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 9.3em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 202x Draft 33)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-A-17-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-A-18-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>A.18 Containers</H1>
<div class="paranum"><a name="p1">1/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-20302.TXT">AI95-00302-03</A></I>} 
This clause presents the specifications of the package Containers and 
several child packages, which provide facilities for storing collections 
of elements.</div>
<div class="paranum"><a name="p1.a">1.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Term entry:&nbsp;</B><B>container</B> 
&mdash; a structured object that represents a collection of elements 
all of the same (potentially class-wide) type, such as a vector or a 
tree<BR>
Note: Several predefined container types are provided by the children 
of package Ada.Containers (see <A HREF="AA-A-18-1.html">A.18.1</A>).</span></div>
<div class="paranum"><a name="p2">2/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-20302.TXT">AI95-00302-03</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0196-1.TXT">AI12-0196-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0416-1.TXT">AI12-0416-1</A></I>} 
A variety of sequence and associative containers are provided. Each container<span class="insert5">&nbsp;package defines</span><span class="delete5">&nbsp;includes</span> a <I>cursor</I> 
type<span class="insert5">&nbsp;as well as a container type</span>. A cursor 
is a reference to an element within a container. Many operations on cursors 
are common to all of the containers. A cursor referencing an element 
in a container is considered to be overlapping <span class="insert5">only 
</span>with the <span class="insert5">element</span><span class="delete5">&nbsp;container 
object</span> itself.<A NAME="I8209"></A> <A NAME="I8210"></A></div>
<div class="paranum"><a name="p2.a">2.a/5</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0005-1.TXT">AI12-0005-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0196-1.TXT">AI12-0196-1</A></I>} 
The last sentence is intended to clarify that operations that just use 
a cursor <span class="insert5">do not interfere if the cursor objects 
designated different elements of the container</span><span class="delete5">&nbsp;are 
on the same footing as operations that use a container</span> in terms 
of the <span class="insert5">concurrent call</span><span class="delete5">&nbsp;reentrancy</span> 
rules of <A HREF="AA-A.html">Annex A</A>.&nbsp;</div>
<div class="paranum"><a name="p2.b">2.b/5</a></div>
<div class="Annotations"><span class="insert5"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0196-1.TXT">AI12-0196-1</A></I>} 
<span class="insert5">A cursor is not considered to overlap with other 
elements of the associated container, thus parallel operations involving 
a set of cursors each operating on mutually exclusive sets of elements 
from the same container are expected to work.</span>&nbsp;</div>
<div class="paranum"><a name="p2.c">2.c/5</a></div>
<div class="Annotations"><span class="insert5"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0416-1.TXT">AI12-0416-1</A></I>} 
<span class="insert5">We use the term &ldquo;container&rdquo; alone when 
it is clear from context what kind of entity (package, type, or object) 
that we are talking about. Otherwise, we use &ldquo;container package&rdquo;, 
&ldquo;container type&rdquo;, or &ldquo;container object&rdquo;. Note 
that &quot;container type&quot; is defined in <A HREF="AA-4-3-5.html">4.3.5</A> 
for a different usage; in all of <A HREF="AA-A-18.html">A.18</A> we mean 
&ldquo;container type&rdquo; to be one of the primary types declared 
in the child packages of package Containers, such as Vector, List, or 
Map.</span>&nbsp;</div>
<div class="paranum"><a name="p2.1">2.1/5</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0111-1.TXT">AI12-0111-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0439-1.TXT">AI12-0439-1</A></I>} 
<span class="insert5">Some operations of the language-defined child units 
of Ada.Containers have access-to-subprogram parameters. To ensure such 
operations are well-defined, they guard against certain actions by the 
designated subprogram. An action on a container that can add or remove 
an element is considered to <I>tamper with cursors</I>,<A NAME="I8211"></A> 
and these are prohibited during all such operations. An action on a container 
that can replace an element with one of a different size is considered 
to <I>tamper with elements</I>, and these are prohibited during certain 
of such operations.<A NAME="I8212"></A> The details of the specific actions 
that are considered to tamper with cursors or elements are defined for 
each child unit of Ada.Containers.</span></div>
<div class="paranum"><a name="p2.2">2.2/5</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0111-1.TXT">AI12-0111-1</A></I>} 
<span class="insert5">Several of the language-defined child units of 
Ada.Containers include a nested package named Stable, which provides 
a view of a container that prohibits any operations that would tamper 
with elements. By using a Stable view for manipulating a container, the 
number of tampering checks performed while performing the operations 
can be reduced. The details of the Stable subpackage are defined separately 
for each child unit of Ada.Containers that includes such a nested package.</span></div>
<div class="paranum"><a name="p3">3/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-20302.TXT">AI95-00302-03</A></I>} 
Within this clause we provide Implementation Advice for the desired average 
or worst case time complexity of certain operations on a container. This 
advice is expressed using the Landau symbol <I>O</I>(X). Presuming f 
is some function of a length parameter N and t(N) is the time the operation 
takes (on average or worst case, as specified) for the length N, a complexity 
of <I>O</I>(f(N)) means that there exists a finite A such that for any 
N, t(N)/f(N) &lt; A. <A NAME="I8213"></A><A NAME="I8214"></A></div>
<div class="paranum"><a name="p3.a">3.a/2</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>Of course, an implementation 
can do better than a specified <I>O</I>(f(N)): for example, <I>O</I>(1) 
meets the requirements for <I>O</I>(log N).</div>
<div class="paranum"><a name="p3.b">3.b/2</a></div>
<div class="Annotations">This concept seems to have as many names as 
there are authors. We used &ldquo;Landau symbol&rdquo; because that's 
what our reference does. But we'd also seen this referred as big-O notation<A NAME="I8215"></A> 
(sometimes written as <I>big-oh</I>), and as Bachmann notation. Whatever 
the name, it always has the above definition.&nbsp;</div>
<div class="paranum"><a name="p4">4/2</a></div>
<div class="Normal">If the advice suggests that the complexity should 
be less than <I>O</I>(f(N)), then for any arbitrarily small positive 
real D, there should exist a positive integer M such that for all N &gt; 
M, t(N)/f(N) &lt; D.</div>
<div class="paranum"><a name="p5">5/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0001-1.TXT">AI05-0001-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0044-1.TXT">AI05-0044-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0416-1.TXT">AI12-0416-1</A></I>} 
When a formal function is used to provide an ordering for a container, 
it is generally required to define a strict weak ordering. A function 
&quot;&lt;&quot; defines a <I>strict weak ordering</I><A NAME="I8216"></A> 
if it is irreflexive, asymmetric, transitive, and in addition, if <I>x</I> 
&lt; <I>y</I> for any values <I>x</I> and <I>y</I>, then for all other 
values <I>z</I>, (<I>x</I> &lt; <I>z</I>) or (<I>z</I> &lt; <I>y</I>).<span class="insert5">&nbsp;Elements are in a <I>smallest first</I><A NAME="I8217"></A> order using 
such an operator if, for every element <I>y</I> with a predecessor <I>x</I> 
in the order, (<I>y</I> &lt; <I>x</I>) is false.</span></div>
<div class="paranum"><a name="p5.a.1">5.a.1/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0416-1.TXT">AI12-0416-1</A></I>} 
<span class="insert5">Given a &quot;&lt;&quot; operator that provides 
a strict weak ordering, knowing that (<I>y</I> &lt; <I>x</I>) is false 
is enough to know that (<I>x</I> &lt;= <I>y</I>) is true. For a strict 
weak ordering, (<I>x</I> = <I>y</I>) when both (<I>x</I> &lt; <I>y</I>) 
and (<I>y</I> &lt; <I>x</I>) are false. Therefore, it is not necessary 
to use the &quot;=&quot; operator or test (<I>x</I> &lt; <I>y</I>). We 
only need to discuss adjacent elements since a strict weak ordering is 
transitive.</span>&nbsp;</div>

<H4 Class="centered">Language Design Principles</H4>
<div class="paranum"><a name="p5.a">5.a/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-20302.TXT">AI95-00302-03</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
This subclause provides a number of useful containers for Ada. Only the 
most useful containers are provided. Ones that are relatively easy to 
code, redundant, or rarely used are omitted from this set, even if they 
are generally included in containers libraries.</div>
<div class="paranum"><a name="p5.b">5.b/2</a></div>
<div class="Annotations">The containers packages are modeled on the Standard 
Template Library (STL), an algorithms and data structure library popularized 
by Alexander Stepanov, and included in the C++ standard library. The 
structure and terminology differ from the STL where that better maps 
to common Ada usage. For instance, what the STL calls &ldquo;iterators&rdquo; 
are called &ldquo;cursors&rdquo; here.</div>
<div class="paranum"><a name="p5.c">5.c/2</a></div>
<div class="Annotations" style="margin-bottom: 0.4em">The following 
major nonlimited containers are provided:</div>
<div class="paranum"><a name="p5.d">5.d/2</a></div>
<div class="SmallBulleted">(Expandable) Vectors of any nonlimited type;</div>
<div class="paranum"><a name="p5.e">5.e/2</a></div>
<div class="SmallBulleted">Doubly-linked Lists of any nonlimited type;</div>
<div class="paranum"><a name="p5.f">5.f/2</a></div>
<div class="SmallBulleted">Hashed Maps keyed by any nonlimited hashable 
type, and containing any nonlimited type;</div>
<div class="paranum"><a name="p5.g">5.g/2</a></div>
<div class="SmallBulleted">Ordered Maps keyed by any nonlimited ordered 
type, and containing any nonlimited type;</div>
<div class="paranum"><a name="p5.h">5.h/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0136-1.TXT">AI05-0136-1</A></I>} 
Hashed Sets of any nonlimited hashable type;</div>
<div class="paranum"><a name="p5.i">5.i/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0136-1.TXT">AI05-0136-1</A></I>} 
Ordered Sets of any nonlimited ordered type;</div>
<div class="paranum"><a name="p5.i.1">5.i.1/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0136-1.TXT">AI05-0136-1</A></I>} 
Multiway Trees of any nonlimited type;</div>
<div class="paranum"><a name="p5.i.2">5.i.2/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0069-1.TXT">AI05-0069-1</A></I>} 
Holders of any (indefinite) nonlimited type;</div>
<div class="paranum"><a name="p5.i.3">5.i.3/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0159-1.TXT">AI05-0159-1</A></I>} 
Synchronized queues of any definite nonlimited type; and</div>
<div class="paranum"><a name="p5.i.4">5.i.4/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0159-1.TXT">AI05-0159-1</A></I>} 
Priority queues of any definite nonlimited type.&nbsp;</div>
<div class="paranum"><a name="p5.j">5.j/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0001-1.TXT">AI05-0001-1</A></I>} 
Separate versions for definite and indefinite element types are provided, 
as those for definite types can be implemented more efficiently. Similarly, 
a separate bounded version is provided in order to give more predictable 
memory usage.</div>
<div class="paranum"><a name="p5.k">5.k/2</a></div>
<div class="Annotations">Each container includes a cursor, which is a 
reference to an element within a container. Cursors generally remain 
valid as long as the container exists and the element referenced is not 
deleted. Many operations on cursors are common to all of the containers. 
This makes it possible to write generic algorithms that work on any kind 
of container.</div>
<div class="paranum"><a name="p5.l">5.l/2</a></div>
<div class="Annotations">The containers packages are structured so that 
additional packages can be added in the future. Indeed, we hope that 
these packages provide the basis for a more extensive secondary standard 
for containers.</div>
<div class="paranum"><a name="p5.m">5.m/2</a></div>
<div class="Annotations">If containers with similar functionality (but 
different performance characteristics) are provided (by the implementation 
or by a secondary standard), we suggest that a prefix be used to identify 
the class of the functionality: &quot;Ada.Containers.Bounded_Sets&quot; 
(for a set with a maximum number of elements); &quot;Ada.Containers.Protected_Maps&quot; 
(for a map which can be accessed by multiple tasks at one time); &quot;Ada.Containers.Persistent_Vectors&quot; 
(for a persistent vector which continues to exist between executions 
of a program) and so on.</div>
<div class="paranum"><a name="p5.n">5.n/2</a></div>
<div class="Annotations" style="margin-bottom: 0.4em">Note that the 
language already includes several requirements that are important to 
the use of containers. These include:</div>
<div class="paranum"><a name="p5.o">5.o/5</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0196-1.TXT">AI12-0196-1</A></I>} 
Library packages must <span class="insert5">allow concurrent calls</span><span class="delete5">&nbsp;be 
reentrant</span> &ndash; multiple tasks can use the packages as long 
as they operate on separate containers. Thus, it is only necessary for 
a user to protect a container if a single container needs to be used 
by multiple tasks<span class="insert5">&nbsp;and concurrent calls to operations 
of the container have overlapping parameters</span>.</div>
<div class="paranum"><a name="p5.p">5.p/2</a></div>
<div class="SmallBulleted">Language-defined types must stream &quot;properly&quot;. 
That means that the stream attributes can be used to implement persistence 
of containers when necessary, and containers can be passed between partitions 
of a program.</div>
<div class="paranum"><a name="p5.q">5.q/2</a></div>
<div class="SmallBulleted">Equality of language-defined types must compose 
&ldquo;properly&rdquo;. This means that the version of &quot;=&quot; 
directly used by users is the same one that will be used in generics 
and in predefined equality operators of types with components of the 
containers and/or cursors. This prevents the abstraction from breaking 
unexpectedly.</div>
<div class="paranum"><a name="p5.q.1">5.q.1/3</a></div>
<div class="SmallBulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0048-1.TXT">AI05-0048-1</A></I>} 
Redispatching is not allowed (unless it is required). That means that 
overriding a container operation will not change the behavior of any 
other predefined container operation. This provides a stable base for 
extensions.&nbsp;</div>
<div class="paranum"><a name="p5.r">5.r/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0258-1.TXT">AI12-0258-1</A></I>} 
If a container's element type is controlled, the point at which the element 
is finalized will depend on the implementation of the container. <span class="insert5">For 
certain kinds of containers, we require finalization behavior based on 
the canonical implementation of the container (see the Implementation 
Requirements below). For the &quot;normal&quot; containers, we</span><span class="delete5">&nbsp;We</span> 
do not specify precisely where this will happen (it will happen no later 
than the finalization of the container, of course) in order to give implementations 
flexibility to cache, block, <span class="delete5">or&nbsp;</span>split <span class="insert5">, 
or reuse</span> the nodes of the container.<span class="delete5">&nbsp;In 
particular, Delete does not necessarily finalize the element; the implementation 
may (or may not) hold the space for reuse.</span></div>
<div class="paranum"><a name="p5.s">5.s/5</a></div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0258-1.TXT">AI12-0258-1</A></I>} 
<span class="delete5">This is not likely to be a hardship, as the element 
type has to be nonlimited. Types used to manage scarce resources generally 
need to be limited. Otherwise, the amount of resources needed is hard 
to control, as the language allows a lot of variation in the number or 
order of adjusts/finalizations. For common uses of nonlimited controlled 
types such as managing storage, the types already have to manage arbitrary 
copies.</span></div>
<div class="paranum"><a name="p5.t">5.t/2</a></div>
<div class="Annotations">The use of controlled types also brings up the 
possibility of failure of finalization (and thus deallocation) of an 
element. This is a &ldquo;serious bug&rdquo;, as AI95-179 puts it, so 
we don't try to specify what happens in that case. The implementation 
should propagate the exception.&nbsp;</div>
<div class="paranum"><a name="p5.u">5.u/2</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>It is expected that 
exceptions propagated from these operations do not damage containers. 
That is, if Storage_Error is propagated because of an allocation failure, 
or Constraint_Error is propagated by the assignment of elements, the 
container can continue to be used without further exceptions. The intent 
is that it should be possible to recover from errors without losing data. 
We don't try to state this formally in most cases, because it is hard 
to define precisely what is and is not allowed behavior.&nbsp;</div>
<div class="paranum"><a name="p5.v">5.v/5</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0005-1.TXT">AI12-0005-1</A></I>} 
When this clause says that the behavior of something is unspecified<A NAME="I8218"></A>, 
we really mean that any result of executing Ada code short of erroneous 
execution is allowed. We do not mean that memory not belonging to the 
parameters of the operation can be trashed. When we mean to allow erroneous 
behavior, we specifically say that execution is erroneous. All this means 
<span class="insert5">that,&nbsp;</span>if the containers are written in Ada<span class="insert5">,</span><span class="delete5">&nbsp;is that</span> checks should not be suppressed or removed assuming some 
behavior of other code, and that the implementation should take care 
to avoid creating internal dangling accesses by assuming behavior from 
generic formals that can't be guaranteed. We don't try to say this normatively 
because it would be fairly complex, and implementers are unlikely to 
increase their support costs by fielding implementations that are unstable 
if given buggy hash functions, et al.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p6">6/4</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0035-1.TXT">AI12-0035-1</A></I>} 
<span class="insert4">Certain subprograms declared within instances of 
some of the generic packages presented in this clause are said to <I>perform 
indefinite insertion</I>. These subprograms are those corresponding (in 
the sense of the copying described in subclause <A HREF="AA-12-3.html">12.3</A>) 
to subprograms that have formal parameters of a generic formal indefinite 
type and that are identified as performing indefinite insertion in the 
subclause defining the generic package.<A NAME="I8219"></A></span></div>
<div class="paranum"><a name="p7">7/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0035-1.TXT">AI12-0035-1</A></I>} 
<span class="insert4">If a subprogram performs indefinite insertion, 
then certain run-time checks are performed as part of a call to the subprogram; 
if any of these checks fail, then the resulting exception is propagated 
to the caller and the container is not modified by the call. These checks 
are performed for each parameter corresponding (in the sense of the copying 
described in <A HREF="AA-12-3.html">12.3</A>) to a parameter in the corresponding 
generic whose type is a generic formal indefinite type. The checks performed 
for a given parameter are those checks explicitly specified in subclause 
<A HREF="AA-4-8.html">4.8</A> that would be performed as part of the 
evaluation of an initialized allocator whose access type is declared 
immediately within the instance, where:</span></div>
<div class="paranum"><a name="p8">8/4</a></div>
<div class="Bulleted"><span class="insert4">the value of the <SPAN Class="swiss"><A HREF="AA-4-7.html#S0163">qualified_expression</A></SPAN> 
is that of the parameter; and</span></div>
<div class="paranum"><a name="p9">9/4</a></div>
<div class="Bulleted"><span class="insert4">the designated subtype of 
the access type is the subtype of the parameter; and</span></div>
<div class="paranum"><a name="p10">10/4</a></div>
<div class="Bulleted"><span class="insert4">finalization of the collection 
of the access type has started if and only if the finalization of the 
instance has started.</span>&nbsp;</div>
<div class="paranum"><a name="p10.a">10.a/4</a></div>
<div class="Annotations"><span class="insert4"><B>Discussion:&nbsp;</B>The 
phrase &quot;explicitly specified&quot; means those checks for which 
subclause <A HREF="AA-4-8.html">4.8</A> includes the phrase &quot;&lt;some 
exception&gt; is raised if ...&quot;. It does not refer, for example, 
to any checks performed as part of any subtype conversion. In particular, 
this wording includes the checks described in subclause <A HREF="AA-4-8.html">4.8</A> 
to be performed in the case of a class-wide designated type, and of a 
designated subtype that has access discriminant parts. These checks are 
needed to prevent containers from outliving their contained (Element_Type 
or Key_Type) values.</span>&nbsp;</div>
<div class="paranum"><a name="p10.b">10.b/4</a></div>
<div class="Annotations"><span class="insert4"><B>Implementation Note: 
</B>These rules have a dual purpose. Mainly, we are <I>requiring</I> 
checks needed to prevent dangling references. As a side effect, we are 
also <I>allowing</I> checks needed to permit an implementation of a container 
generic to make use of access types in a straightforward way. As an example 
of the second purpose, suppose that an implementation does declare such 
an access type and suppose further that the finalization of the collection 
of the access type has started. These rules allow Program_Error to be 
propagated in this case (as specified in <A HREF="AA-4-8.html">4.8</A>); 
this is necessary to allow an all-Ada implementation of these packages.</span> 
</div>

<H4 Class="centered">Implementation Requirements</H4>
<div class="paranum"><a name="p11">11/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0258-1.TXT">AI12-0258-1</A></I>} 
<span class="insert5">For an indefinite container (one whose type is 
defined in an instance of a child package of Containers whose <SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN> 
contains &quot;Indefinite&quot;), each element of the container shall 
be created when it is inserted into the container and finalized when 
it is deleted from the container (or when the container object is finalized 
if the element has not been deleted). For a bounded container (one whose 
type is defined in an instance of a child package of Containers whose 
<SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN> 
starts with &quot;Bounded&quot;) that is not an indefinite container, 
all of the elements of the capacity of the container shall be created 
and default initialized when the container object is created; the elements 
shall be finalized when the container object is finalized. [For other 
kinds of containers, when elements are created and finalized is unspecified.]</span></div>
<div class="paranum"><a name="p11.a">11.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Ramification:&nbsp;</B>This 
allows a user to be able to reason about the behavior of elements that 
have controlled parts. In most cases, such elements need to be stored 
in an indefinite container.</span>&nbsp;</div>
<div class="paranum"><a name="p11.b">11.b/5</a></div>
<div class="Annotations"><span class="insert5"><B>Implementation Note: 
</B>If the containers are implemented in Ada, this implies that elements 
for an indefinite container are allocated individually, and that a bounded 
container contains an array of elements or other data structure that 
is initialized for the entire capacity of the container when it is created. 
There is no such restriction on the implementation of the &quot;normal&quot; 
containers; these can be handled in any way convenient to the implementation 
&mdash; in particular, node reuse is allowed.</span>&nbsp;</div>
<div class="paranum"><a name="p12">12/5</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0112-1.TXT">AI12-0112-1</A></I>} 
<span class="insert5">For an instance <I>I</I> of a container package 
with a container type, the specific type <I>T</I> of the object returned 
from a function that returns an object of an iterator interface, as well 
as the primitive operations of <I>T</I>, shall be nonblocking. The Global 
aspect specified for <I>T</I> and the primitive operations of <I>T</I> 
shall be <TT>(<B>in all</B>, <B>out synchronized</B>)</TT> or a specification 
that allows access to fewer global objects.</span></div>
<div class="paranum"><a name="p12.a">12.a/5</a></div>
<div class="Annotations"><span class="insert5"><B>Implementation Note: 
</B>This requires that the traversal and iteration operations of a container 
do not create, destroy, or assign any objects of a formal type of <I>I</I>, 
nor call any formal subprograms of <I>I</I>. Those objects and subprograms 
might be blocking (depending on the actual parameters). We put similar 
requirements on the individual traversal operations in the container 
package definitions.</span>&nbsp;</div>
<div class="paranum"><a name="p12.b">12.b/5</a></div>
<div class="Annotations"><span class="insert5"><B>Reason:&nbsp;</B>These requirements 
allows users to use container iterators inside of parallel constructs, 
regardless of the actual parameters to the instantiation. If such an 
iterator allowed blocking, it would be illegal inside of a parallel construct 
(see <A HREF="AA-9-5.html">9.5</A>). If such an iterator allowed writing 
of unsynchronized global objects, it would be illegal when the default 
conflict checking policy is in effect (see <A HREF="AA-9-10-1.html">9.10.1</A>). 
These requirements include sequential iterators; the iterator does not 
need to appear in a parallel loop to trigger these requirements.</span> 
</div>
<div class="paranum"><a name="p12.c">12.c/5</a></div>
<div class="Annotations"><span class="insert5"><B>Discussion:&nbsp;</B>We 
have to give these requirements as a text rule, as there is no place 
to declare suitable aspects. The specific type of a container iterator 
is declared by the implementation and is not part of the visible specification 
(iterator functions just return a value of a class-wide type). The iterator 
interface itself cannot impose such a requirement since it needs to be 
able to work with user-defined types that do need to allow blocking. 
We give this as a global requirement to avoid duplication.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p12.d">12.d/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-20302.TXT">AI95-00302-03</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
<A NAME="I8220"></A>This subclause is new. It just provides an introduction 
to the following subclauses.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2005</H4>
<div class="paranum"><a name="p12.e">12.e/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0044-1.TXT">AI05-0044-1</A></I>} 
<B>Correction:</B> Added a definition of strict weak ordering.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p12.f">12.f/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0196-1.TXT">AI12-0196-1</A></I>} 
<span class="insert5"><A NAME="I8221"></A><B>Correction:</B> We now say 
that a cursor only overlaps with the element it designates, rather than 
with the whole container. This allows some reading operations to operate 
on the container in parallel without separate synchronization.</span> 
</div>

<H4 Class="centered">Wording Changes from Ada 2012</H4>
<div class="paranum"><a name="p12.g">12.g/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0035-1.TXT">AI05-0035-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Added a definition of &ldquo;performs 
indefinite insertion&rdquo;. This is used in other subclauses and any 
resulting inconsistencies are documented there.</span></div>
<div class="paranum"><a name="p12.h">12.h/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0111-1.TXT">AI12-0111-1</A></I>} 
<span class="insert5">Moved the basic description of tampering checks 
here, to cut duplication in description of the individual containers. 
Added a description of stable views of containers.</span></div>
<div class="paranum"><a name="p12.i">12.i/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0112-1.TXT">AI12-0112-1</A></I>} 
<span class="insert5">Added a global requirement that iterators returned 
from containers are nonblocking if the instance is nonblocking.</span></div>
<div class="paranum"><a name="p12.j">12.j/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0258-1.TXT">AI12-0258-1</A></I>} 
<span class="insert5"><B>Correction:</B> Defined when objects are created 
and finalized for Bounded and Indefinite containers, so that these can 
be used reliably with controlled element types. This is not incompatible 
as this behavior was previously unspecified; code depending on specific 
behavior was wrong.</span></div>
<div class="paranum"><a name="p12.k">12.k/5</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0005-1.TXT">AI12-0005-1</A></I>} 
<span class="insert5"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0416-1.TXT">AI12-0416-1</A></I>} 
<span class="insert5">Added a definition of &ldquo;smallest first&rdquo; 
ordering, so that the behavior of the Sort procedures when elements are 
equal is well-defined.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-A-17-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-A-18-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
